# 分布式锁总结

1. redis分布式锁注意事项。
   1. 原子命令加锁。
   1. value的值设置为随机数主要是为了更安全的释放锁。
   1. 为了保障原子性，我们需要用 lua 脚本。
2. redis分布式锁问题。
   1. Redis 分布式锁过期了，还没处理完。
      1. 守护线程“续命”（Redisson “看门狗”）。
         >master-slave的时候有漏洞，可以用redlock，但是redlock 1，复杂。2，依赖系统时钟。
      1. 超时回滚。
3. zookeeper。
   1. 有自增序号（类似version）。
   1. 前任挂了，有通知通知后一任（则监听自己的上一个节点的删除事件）。
4. zookeeper强一致性，但是性能弱于redis。

## 引用
>1. [面试必问的分布式锁，你懂了吗？](https://mp.weixin.qq.com/s/1XP_GmZ58B4CspdaTHJGJA)
>1. [面试必问：分布式锁到底用Redis好？还是Zookeeper好？](https://mp.weixin.qq.com/s/xdqN5gVJnVhmnLIU6Khu4A)
>1. [Redis 分布式锁使用不当，超卖了100瓶飞天茅台！！！](https://blog.csdn.net/bntX2jSQfEHy7/article/details/111148083)
>1. [Redis锁从面试连环炮聊到神仙打架。](https://mp.weixin.qq.com/s/WXnAzYbVZ7GAT6AnOeFSgA)