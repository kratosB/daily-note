upstream webappA {
  server uat1.dcfservice.com:21001;
}

upstream webappB {
  server uat1.dcfservice.com:21001;
}

upstream webapp {
  server uat1.dcfservice.com:21001;
  server uat2.dcfservice.com:21001;
  check interval=10000 rise=2 fall=2 timeout=2000 type=http;
  check_http_send "GET /api/health HTTP/1.0\r\nHost: 127.0.0.1\r\n\r\n";
  check_http_expect_alive http_2xx http_3xx;

}



#upstream openapi {
 # server openapi01:21024;
  #server openapi02:21024;
  #check interval=10000 rise=2 fall=2 timeout=2000 type=http;
   #check interval=10000 rise=2 fall=2 timeout=2000 type=http;
    #check_http_send "GET /api/health HTTP/1.0\r\n\r\n";
    #check_http_expect_alive http_2xx http_3xx;
#}

upstream bbs {
   server uat03-2.dcfservice.com:21029;
  #server uat2.dcfservice.com:8103;
}



upstream dirtydataA {
  server uat1.dcfservice.com:21037;
}
upstream dirtydataB {
  server uat2.dcfservice.com:21037;
}
upstream dirtydata {
  server uat1.dcfservice.com:21037;
  server uat2.dcfservice.com:21037;
}


upstream mapiA {
  server uat1.dcfservice.com:21003;
  check interval=10000 rise=2 fall=2 timeout=2000 type=http;
  check_http_send "GET /api/health HTTP/1.0\r\n\r\n";
  check_http_expect_alive http_2xx http_3xx;
}
upstream mapiB {
  server uat2.dcfservice.com:21003;
  check interval=10000 rise=2 fall=2 timeout=2000 type=http;
  check_http_send "GET /api/health HTTP/1.0\r\n\r\n";
  check_http_expect_alive http_2xx http_3xx;
}
upstream mapi {
  server uat1.dcfservice.com:21003;
  server uat2.dcfservice.com:21003;
  check interval=10000 rise=2 fall=2 timeout=2000 type=http;
  check_http_send "GET /api/health HTTP/1.0\r\n\r\n";
  check_http_expect_alive http_2xx http_3xx;
}


upstream gatewayA {
  server uat1.dcfservice.com:23003;
}
upstream gatewayB {
  server uat2.dcfservice.com:23003;
}
upstream gateway {
  server uat1.dcfservice.com:23003;
  server uat2.dcfservice.com:23003;
  check interval=10000 rise=2 fall=2 timeout=2000 type=http;
  check_http_send "GET /health HTTP/1.0\r\n\r\n";
  check_http_expect_alive http_2xx http_3xx;

}
upstream bi_proxy {
  server 192.168.98.92:8080;
}


    server {
        listen       80;
        server_name  localhost;
        access_log  /data/nginx/logs/default_access.log  main;
    #rewrite ^/(.*) https://wuat.dcfservice.com/$1 permanent;
        rewrite ^(.*)$  https://$host$1 permanent;
        location / {
            root   /var/www/default;
            index  index.html index.htm;
        }
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }

    server {
        listen       80;
        listen       443 ssl http2;
        server_name  wuat.dcfservice.com dcfservice.com wuat.iqunxing.com test1.iqunxing.com;
        keepalive_timeout  65;
        index index.html;
        access_log  /data/nginx/logs/wuat.dcfservice.com.log  main;
        error_log   /data/nginx/logs/www.dcfservice.error.log;

        include env.var;
        include external.var;

        location ^~/api/ {
           proxy_pass http://gateway$prefix;
           proxy_set_header   Host             $host;
           proxy_set_header   X-Real-IP        $remote_addr;
           proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
           proxy_set_header   XGrayRelease   $XGrayRelease;
        }

        location ^~/openapi/ {
           proxy_pass http://gateway$prefix;
           proxy_set_header   Host             $host;
           proxy_set_header   X-Real-IP        $remote_addr;
           proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
           proxy_set_header   XGrayRelease   $XGrayRelease;
        }


        location ^~/v1/ {
           proxy_pass http://webapp$prefix;
           proxy_set_header   Host             $host;
           proxy_set_header   X-Real-IP        $remote_addr;
           proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
           proxy_set_header   XGrayRelease   $XGrayRelease;
        }

        location ^~/open/ {
            proxy_pass http://open$prefix;
            proxy_set_header    Host            $host;
            proxy_set_header    X-Real-IP        $remote_addr;
            proxy_set_header    X-Forwarded-For    $proxy_add_x_forwarded_for;
            proxy_set_header   XGrayRelease   $XGrayRelease;
        }


        location ^~/cashier/ {
	    proxy_pass http://cashier$prefix;
            proxy_set_header    Host            $host;
            proxy_set_header    X-Real-IP        $remote_addr;
            proxy_set_header    X-Forwarded-For    $proxy_add_x_forwarded_for;
            proxy_set_header   XGrayRelease   $XGrayRelease;
        }



        location ~ /(ln|md|qr|tp) {

            proxy_pass http://bi_proxy;
            proxy_set_header    Host            $host;
            proxy_set_header    X-Real-IP        $remote_addr;
            proxy_set_header    X-Forwarded-For    $proxy_add_x_forwarded_for;
 #           proxy_set_header   XGrayRelease   $XGrayRelease;
        }


        location /metersbonwe/ {
            rewrite ^(.*)$ /minisites/metersbonwe/?channel=iqx_print redirect;
        }

        location ~* ^/(?![minisites]) {
            root /data/static_1048/dist;
        #    if ( $http_user_agent ~* '(Android|webOS|iPhone|iPod|BlackBerry)') {
                #rewrite ^/(.*)$ http://muat.dcfservice.com/$1 permanent;
        #        rewrite ^/(.*)$ https://uat.dcfservice.com/m/$1 permanent;
        #    }
        }

        ssl                  on;
        ssl_certificate /usr/local/tengine/conf/fullchain.pem;
        ssl_certificate_key /usr/local/tengine/conf/privkey.pem;
        ssl_session_timeout  5m;

        #ssl_protocols  SSLv3 TLSv1;
        #ssl_ciphers  HIGH:!ADH:!EXPORT56:RC4+RSA:+MEDIUM;
        #ssl_prefer_server_ciphers   on;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-RC4-SHA:!ECDHE-RSA-RC4-SHA:ECDH-ECDSA-RC4-SHA:ECDH-RSA-RC4-SHA:ECDHE-RSA-AES256-SHA:!RC4-SHA:HIGH:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!CBC:!EDH:!kEDH:!PSK:!SRP:!kECDH;
        ssl_prefer_server_ciphers   on;


        location ^~ /services/ {
                #rewrite ^(.*)$ http://auat.dcfservice.com$1 break;
                proxy_pass http://auat.dcfservice.com;
                proxy_set_header X-Real-IP $remote_addr;
        }

        rewrite ^/login.jsp https://wuat.dcfservice.com permanent;
        rewrite ^/view/(.*)$ https://huat.dcfservice.com/view/$1 permanent;
        rewrite ^/views/(.*)$ https://huat.dcfservice.com/views/$1 permanent;
        rewrite ^/public/(.*)$ https://huat.dcfservice.com/public/$1 permanent;
        rewrite ^/assets/(.*)$ https://huat.dcfservice.com/assets/$1 permanent;
        rewrite ^/download/(.*)$ https://huat.dcfservice.com/download/$1 permanent;
        rewrite ^/js/lib/(.*)$ https://huat.dcfservice.com/js/lib/$1 permanent;

    location ^~ /video/ {
            root /data/;
        }

        location ^~ /minisites/video/ {
            alias /data/video/minisites/;
        }

        location /v1/(.*)$ {
           proxy_pass http://webapp$prefix;
           proxy_set_header   Host             $host;
           proxy_set_header   X-Real-IP        $remote_addr;
           proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
           proxy_set_header   XGrayRelease   $XGrayRelease;
        }

        location /mapi/ {
           proxy_pass http://mapi$prefix;
           proxy_set_header   Host             $host;
           proxy_set_header   X-Real-IP        $remote_addr;
           proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
           proxy_set_header   XGrayRelease   $XGrayRelease;
        }

        location ^~ /minisites {
            root /data/static_1028;
        }

        location ^~ /sales_tools {
            alias /data/static_1056;
        }

        location ^~ /jaguar {
            alias /data/static_1057;
        }

        location ^~ /chain {
           alias /data/static_1060;
        }

        location /m/ {
            alias /data/static_1013/;
            index home.html;
        }

        location / {
            root /data/static_1048/dist;
            index index.html;
        }

        gzip  on;
        gzip_min_length  1k;
        gzip_buffers     4 16k;
        gzip_comp_level 7;
        gzip_types text/plain application/x-javascript text/css application/xml application/json application/octet-stream application/javascript image/jpeg image/gif image/png;

        error_page 404  /html/404.html;
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }




#    server {
#        listen       80;
#        listen         443;
#        server_name  muat.dcfservice.com;
#        keepalive_timeout  65;
#
#        index home.html;
#    access_log  /data/nginx/logs/muat.dcfservice.com.log  main;
#    error_log   /data/nginx/logs/muat.dcfservice.error.log;
#    #rewrite example: /view/13t9/07 --> /s.htm?13t9,07
#    rewrite "^/view/(.*)/([0-9]{2})$" /s.htm?$1,$2 permanent;
#
#    if ($server_port = 80){
#        #return 301 https://$server_name$request_uri;
#    }
#
#        ssl                  on;
#        ssl_certificate /usr/local/tengine/conf/fullchain.pem;
#        ssl_certificate_key /usr/local/tengine/conf/privkey.pem;
#        ssl_session_timeout  5m;
#
#        ssl_protocols  SSLv3 TLSv1;
#        ssl_ciphers  HIGH:!ADH:!EXPORT56:RC4+RSA:+MEDIUM;
#        ssl_prefer_server_ciphers   on;
#
#    #redirect POST request to GET
#    location ~ (^/repay.html(.*)$) {
#       root /data/static_1004;
#       error_page 405 =200 $1;
#    }
#
#        location / {
#       root /data/static_1004;
#        }
#
#    location /download {
#       root /data/mobile-webapp;
#    }
#
#        location /kf {
#           index index.html;
#       root /data/static_1004;
#        }
#
#        location /services {
#        proxy_pass http://webapp;
#    }
#
#        gzip  on;
#        gzip_min_length  1000;
#        gzip_buffers     4 8k;
#        gzip_comp_level 7;
#        gzip_types text/plain application/x-javascript text/css application/xml application/json application/octet-stream application/javascript;
#
#    error_page 404  /404.html;
#        location = /404.html {
#        root /data/static_1004;
#    }
#        error_page   500 502 503 504  /50x.html;
#        location = /50x.html {
#            root   html;
#        }
#    }

    server {
        listen       80;
        listen       8082;
        server_name  prd-apiï¼›
        keepalive_timeout  60;
    access_log  /data/nginx/logs/auat.dcfservice.com.log  main;
    error_log   /data/nginx/logs/auat.dcfservice.error.log;

        include env.var;
        include external.var;

        location / {

#           if ($http_referer ~* ^(http[s]*://[a-zA-Z0-9\.\:]+)) {
#                  set $refer_host $1;
#           }
#
#           if ($request_method = 'OPTIONS') {
#                #add_header 'Access-Control-Allow-Origin' '$refer_host';
                                 add_header 'Access-Control-Allow-Origin' '*';
                               add_header 'Access-Control-Allow-Headers' 'X-Requested-With';
#                add_header 'Access-Control-Max-Age' '86400';
#                add_header 'Access-Control-Allow-Credentials' 'true';
#                add_header 'Access-Control-Allow-Methods' 'GET,POST,OPTIONS';
                 add_header 'Access-Control-Allow-Headers' 'tk, rm';
#                return 204;
#           }
#           if ($request_method != 'OPTIONS') {
#               #add_header 'Access-Control-Allow-Origin' '$refer_host';
                                add_header 'Access-Control-Allow-Origin' '*';
                 add_header 'Access-Control-Allow-Headers' 'X-Requested-With';
#                add_header 'Access-Control-Max-Age' '86400' 'always';
#                add_header 'Access-Control-Allow-Credentials' 'true';
#                add_header 'Access-Control-Expose-Headers' 'tk, rm';
#           }

           proxy_pass http://api$prefix;
           proxy_set_header   Host             $host;
           proxy_set_header   X-Real-IP        $remote_addr;
           proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
           proxy_set_header   XGrayRelease   $XGrayRelease;
        }

    location /services/public/sms/get {
                return 403;
        }
        location /services/public/sms/generate {
                return 403;
        }

        gzip  on;
        gzip_min_length  1000;
        gzip_buffers     4 8k;
        gzip_comp_level 7;
        gzip_types text/plain application/x-javascript text/css application/xml application/json application/octet-stream;

    }

    server {
        listen       443;
        server_name  prd-api auat.dcfservice.com;
        keepalive_timeout  60;
        access_log  /data/nginx/logs/auat.dcfservice.com.log  main;
        error_log   /data/nginx/logs/auat.dcfservice.error.log;

        ssl                  on;
        ssl_certificate /usr/local/tengine/conf/fullchain.pem;
        ssl_certificate_key /usr/local/tengine/conf/privkey.pem;
        ssl_session_timeout  5m;

      #  ssl_protocols  SSLv3 TLSv1;
      #  ssl_ciphers  HIGH:!ADH:!EXPORT56:RC4+RSA:+MEDIUM;
      #  ssl_prefer_server_ciphers   on;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-RC4-SHA:!ECDHE-RSA-RC4-SHA:ECDH-ECDSA-RC4-SHA:ECDH-RSA-RC4-SHA:ECDHE-RSA-AES256-SHA:!RC4-SHA:HIGH:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!CBC:!EDH:!kEDH:!PSK:!SRP:!kECDH;
        ssl_prefer_server_ciphers   on;


        include env.var;
        include external.var;

        location / {
#           if ($http_referer ~* ^(http[s]*://[a-zA-Z0-9\.\:]+)) {
#                set $refer_host $1;
#           }
#
#           if ($request_method = 'OPTIONS') {
#                add_header 'Access-Control-Allow-Origin' '$refer_host';
#                add_header 'Access-Control-Max-Age' '86400';
#                add_header 'Access-Control-Allow-Credentials' 'true';
#                add_header 'Access-Control-Allow-Methods' 'GET,POST,OPTIONS';
#                add_header 'Access-Control-Allow-Headers' 'tk, rm';
#                return 204;
#           }
#           if ($request_method != 'OPTIONS') {
#                add_header 'Access-Control-Allow-Origin' '$refer_host' 'always';
#                add_header 'Access-Control-Max-Age' '86400' 'always';
#                add_header 'Access-Control-Allow-Credentials' 'true' 'always';
#                add_header 'Access-Control-Expose-Headers' 'tk, rm' 'always';
#           }

           proxy_pass http://api$prefix;
           proxy_set_header   Host             $host;
           proxy_set_header   X-Real-IP        $remote_addr;
           proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
           proxy_set_header   XGrayRelease   $XGrayRelease;
        }

    location /services/public/sms/get {
                return 403;
        }
        location /services/public/sms/generate {
                return 403;
        }

        gzip  on;
        gzip_min_length  1000;
        gzip_buffers     4 8k;
        gzip_comp_level 7;
        gzip_types text/plain application/x-javascript text/css application/xml application/json application/octet-stream;

        error_page   404 /html/404.html;
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }

    }

    server {
        listen       443;
        server_name  openapi.dcfservice.com;
        keepalive_timeout  60;
        access_log  /data/nginx/logs/openapi.iqunxing.com.log  main;
        error_log   /data/nginx/logs/openapi.iqunxing.error.log;

        ssl                  on;
        ssl_certificate /usr/local/tengine/conf/fullchain.pem;
        ssl_certificate_key /usr/local/tengine/conf/privkey.pem;
        ssl_session_timeout  5m;

       # ssl_protocols  SSLv3 TLSv1;
       # ssl_ciphers  HIGH:!ADH:!EXPORT56:RC4+RSA:+MEDIUM;
       # ssl_prefer_server_ciphers   on;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-RC4-SHA:!ECDHE-RSA-RC4-SHA:ECDH-ECDSA-RC4-SHA:ECDH-RSA-RC4-SHA:ECDHE-RSA-AES256-SHA:!RC4-SHA:HIGH:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!CBC:!EDH:!kEDH:!PSK:!SRP:!kECDH;
        ssl_prefer_server_ciphers   on;



        location / {
           if ($http_referer ~* ^(http[s]*://[a-zA-Z0-9\.\:]+)) {
                set $refer_host $1;
           }

           if ($request_method = 'OPTIONS') {
                add_header 'Access-Control-Allow-Origin' '*';
                #add_header 'Access-Control-Allow-Origin' '$refer_host';
                add_header 'Access-Control-Max-Age' '86400';
                add_header 'Access-Control-Allow-Credentials' 'true';
                add_header 'Access-Control-Allow-Methods' 'GET,POST,OPTIONS';
                add_header 'Access-Control-Allow-Headers' 'tk, rm';
                return 204;
           }
           if ($request_method != 'OPTIONS') {
                #add_header 'Access-Control-Allow-Origin' '$refer_host';
                add_header 'Access-Control-Allow-Origin' '*';
                add_header 'Access-Control-Max-Age' '86400';
                add_header 'Access-Control-Allow-Credentials' 'true';
                add_header 'Access-Control-Expose-Headers' 'tk, rm';
           }

           #proxy_pass http://openapi;
           proxy_set_header   Host             $host;
           proxy_set_header   X-Real-IP        $remote_addr;
           proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;

        }

        gzip  on;
        gzip_min_length  1000;
        gzip_buffers     4 8k;
        gzip_comp_level 7;
        gzip_types text/plain application/x-javascript text/css application/xml application/json application/octet-stream;

        error_page   404 /html/404.html;
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }

    }

    server {
        listen        80;
        server_name    test.iqunxing.com test3.iqunxing.com ns1.xqbase.com;
        keepalive_timeout    65;
        access_log    /data/nginx/logs/open.log  main;
        error_log    /data/nginx/logs/open.error.log;

    include env.var;
    include external.var;

        location /open/ {
            proxy_pass http://open$prefix;
            proxy_set_header    Host            $host;
            proxy_set_header    X-Real-IP        $remote_addr;
            proxy_set_header    X-Forwarded-For    $proxy_add_x_forwarded_for;
            proxy_set_header   XGrayRelease   $XGrayRelease;
        }

        location /auth/ {
            proxy_pass http://open$prefix;
            proxy_set_header    Host            $host;
            proxy_set_header    X-Real-IP        $remote_addr;
            proxy_set_header    X-Forwarded-For    $proxy_add_x_forwarded_for;
      proxy_set_header   XGrayRelease   $XGrayRelease;
        }
    }

    server {
        listen       80;
        listen       443;
        server_name  huat.dcfservice.com huat.iqunxing.com test2.iqunxing.com;
        keepalive_timeout  65;
        access_log  /data/nginx/logs/huat.dcfservice.com.log  main;
        error_log   /data/nginx/logs/huat.dcfservice.error.log;

        ssl                  on;
        ssl_certificate /usr/local/tengine/conf/fullchain.pem;
        ssl_certificate_key /usr/local/tengine/conf/privkey.pem;
        ssl_session_timeout  5m;

       # ssl_protocols  SSLv3 TLSv1;
       # ssl_ciphers  HIGH:!ADH:!EXPORT56:RC4+RSA:+MEDIUM;
       # ssl_prefer_server_ciphers   on;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-RC4-SHA:!ECDHE-RSA-RC4-SHA:ECDH-ECDSA-RC4-SHA:ECDH-RSA-RC4-SHA:ECDHE-RSA-AES256-SHA:!RC4-SHA:HIGH:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!CBC:!EDH:!kEDH:!PSK:!SRP:!kECDH;
        ssl_prefer_server_ciphers   on;


    rewrite ^/login.jsp$ http://wuat.dcfservice.com permanent;

        include env.var;
        include external.var;

        location ^~/api/ {
           proxy_pass http://gateway$prefix;
           proxy_set_header   Host             $host;
           proxy_set_header   X-Real-IP        $remote_addr;
           proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
           proxy_set_header   XGrayRelease   $XGrayRelease;
        }

        location /v1/public/sms/generate {
               return 403;
        }

        location /v1/public/sms/get {
               return 403;
        }

        location /download {
           #if ($request_filename ~* ^.*?\.(txt|doc|pdf|rar|gz|zip|docx|exe|xlsx|ppt|pptx|xls|jpg|bmp|png)$){
           if ($request_filename ~* ^.*?\.(txt|doc|rar|gz|zip|docx|exe|xlsx|ppt|pptx|xls)$){
              add_header Content-Disposition 'attachment';
           }
           # same as fileDir.location in system.properties
           root /data/iqunxing/;
        }

    #location ~ .*\.(html|apk|css|js|gif|jpg|jpeg|png|bmp|swf|ttf|woff|eot|svg|exe)$ {
        #   root /data/tomcat_1001/webapps/ROOT;
    #}

#    location /v1/public/payment/callback/chinaclearingPayCallback {
#           proxy_pass http://t3;
#           proxy_set_header   Host             $host;
#           proxy_set_header   X-Real-IP        $remote_addr;
#           proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
#        }


        location /cashier/ {
           proxy_pass http://cashier$prefix;
           proxy_set_header   Host             $host;
           proxy_set_header   X-Real-IP        $remote_addr;
           proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
           proxy_set_header   XGrayRelease   $XGrayRelease;
        }

        location /mapi/ {
           proxy_pass http://mapi$prefix;
           proxy_set_header   Host             $host;
           proxy_set_header   X-Real-IP        $remote_addr;
           proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
           proxy_set_header   XGrayRelease   $XGrayRelease;
        }

        location / {
           proxy_hide_header Access-Control-Allow-Origin;
           add_header Access-Control-Allow-Origin $http_origin;
           proxy_hide_header Access-Control-Allow-Credentials;
           add_header Access-Control-Allow-Credentials true;
           add_header Access-Control-Allow-Headers X-Requested-With;
           add_header 'Access-Control-Allow-Methods' 'GET,POST,OPTIONS';
           add_header 'Access-Control-Allow-Headers' 'tk, rm';

           if ($request_method = 'OPTIONS') {
              return 204;
           }

           proxy_pass http://webapp$prefix;
           proxy_set_header   Host             $host;
           proxy_set_header   X-Real-IP        $remote_addr;
           proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
           proxy_set_header   XGrayRelease   $XGrayRelease;
        }

        gzip  on;
        gzip_min_length  1000;
        gzip_buffers     4 8k;
        gzip_comp_level 7;
        gzip_types text/plain application/x-javascript text/css application/xml application/json application/octet-stream;

        #error_page 404  /404.html;
        #    location = /404.html {
        #    root /data/mobile-webapp;
        #}
    error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }

    server {
        listen       443;
        server_name  uat.dcfservice.com;
        keepalive_timeout  65;
        access_log  /data/nginx/logs/uat.dcfservice.com.log  main;
        error_log   /data/nginx/logs/uat.dcfservice.error.log;

        ssl                  on;
        ssl_certificate /usr/local/tengine/conf/fullchain.pem;
        ssl_certificate_key /usr/local/tengine/conf/privkey.pem;
        ssl_session_timeout  5m;

       # ssl_protocols  SSLv3 TLSv1;
       # ssl_ciphers  HIGH:!ADH:!EXPORT56:RC4+RSA:+MEDIUM;
       # ssl_prefer_server_ciphers   on;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-RC4-SHA:!ECDHE-RSA-RC4-SHA:ECDH-ECDSA-RC4-SHA:ECDH-RSA-RC4-SHA:ECDHE-RSA-AES256-SHA:!RC4-SHA:HIGH:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!CBC:!EDH:!kEDH:!PSK:!SRP:!kECDH;
        ssl_prefer_server_ciphers   on;


    rewrite ^/login.jsp$ http://wuat.dcfservice.com permanent;

        include env.var;
        include external.var;

        location ^~/api/ {
           proxy_pass http://gateway$prefix;
           proxy_set_header   Host             $host;
           proxy_set_header   X-Real-IP        $remote_addr;
           proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
           proxy_set_header   XGrayRelease   $XGrayRelease;
        }

        location /v1/public/sms/generate {
               return 403;
        }

        location /v1/public/sms/get {
               return 403;
        }

        location /download {
           #if ($request_filename ~* ^.*?\.(txt|doc|pdf|rar|gz|zip|docx|exe|xlsx|ppt|pptx|xls|jpg|bmp|png)$){
           if ($request_filename ~* ^.*?\.(txt|doc|rar|gz|zip|docx|exe|xlsx|ppt|pptx|xls)$){
              add_header Content-Disposition 'attachment';
           }
           # same as fileDir.location in system.properties
           root /data/iqunxing/;
        }

        location /mapi/ {
           proxy_pass http://mapi$prefix;
           proxy_set_header   Host             $host;
           proxy_set_header   X-Real-IP        $remote_addr;
           proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
           proxy_set_header   XGrayRelease   $XGrayRelease;
        }

        location / {
           rewrite ^/m$ https://$host$uri/ permanent;
           proxy_hide_header Access-Control-Allow-Origin;
           add_header Access-Control-Allow-Origin $http_origin;
           proxy_hide_header Access-Control-Allow-Credentials;
           add_header Access-Control-Allow-Credentials true;
           add_header Access-Control-Allow-Headers X-Requested-With;
           add_header 'Access-Control-Allow-Methods' 'GET,POST,OPTIONS';
           add_header 'Access-Control-Allow-Headers' 'tk, rm';

           if ($request_method = 'OPTIONS') {
              return 204;
           }

           proxy_pass http://webapp$prefix;
           proxy_set_header   Host             $host;
           proxy_set_header   X-Real-IP        $remote_addr;
           proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
           proxy_set_header   XGrayRelease   $XGrayRelease;
        }

        location /m/ {
            alias /data/static_1013/;
            index home.html;
        }


        gzip  on;
        gzip_min_length  1000;
        gzip_buffers     4 8k;
        gzip_comp_level 7;
        gzip_types text/plain application/x-javascript text/css application/xml application/json application/octet-stream;

    error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }


    server {
        listen       80;
        server_name  fix.dcfservice.com;
        keepalive_timeout  0;
        access_log  /data/nginx/logs/fix.log  main;
        error_log  /data/nginx/logs/fix_error.log;


        location / {
       allow 221.133.227.226;
       allow 10.0.0.0/8;
       deny all;

        include env.var;
        include external.var;

           proxy_pass http://dirtydata$prefix;
           proxy_set_header   Host             $host;
           proxy_set_header   X-Real-IP        $remote_addr;
           proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
           proxy_set_header   XGrayRelease   $XGrayRelease;
        }
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }

    }

server {
        listen       80;
        server_name  financeplan.dcfservice.com;
        keepalive_timeout  0;
        access_log  /data/nginx/logs/financeplan.log  main;
        error_log  /data/nginx/logs/financeplan_error.log;


        location / {
        root    /data/iqunxing-financeplan;
        }

    }


server {
        listen       443;
        server_name  financeplan.dcfservice.com;
        keepalive_timeout  0;
        access_log  /data/nginx/logs/financeplan.log  main;
        error_log  /data/nginx/logs/financeplan_error.log;

        ssl                  on;
        ssl_certificate /usr/local/tengine/conf/fullchain.pem;
        ssl_certificate_key /usr/local/tengine/conf/privkey.pem;
        ssl_session_timeout  5m;

       # ssl_protocols  SSLv3 TLSv1;
       # ssl_ciphers  HIGH:!ADH:!EXPORT56:RC4+RSA:+MEDIUM;
       # ssl_prefer_server_ciphers   on;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-RC4-SHA:!ECDHE-RSA-RC4-SHA:ECDH-ECDSA-RC4-SHA:ECDH-RSA-RC4-SHA:ECDHE-RSA-AES256-SHA:!RC4-SHA:HIGH:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!CBC:!EDH:!kEDH:!PSK:!SRP:!kECDH;
        ssl_prefer_server_ciphers   on;


        location / {
        root    /data/iqunxing-financeplan;
        }

    }


    server {
        listen       80;
        server_name  bbsuat.dcfservice.com;
        keepalive_timeout  0;
        access_log  /data/nginx/logs/bbs.log  main;
        error_log  /data/nginx/logs/bbs_error.log;


        location / {
           proxy_pass http://bbs;
           proxy_set_header   Host             $host;
           proxy_set_header   X-Real-IP        $remote_addr;
           proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
        }
    location /socket.io/ {
            proxy_pass http://bbs;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection "upgrade";
    }

    location ~* /uploads/.*\.(gif|jpg|jpeg|png|bmp|ico)$ {
        root /data/iqunxing-bbs;
        }


        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
   }

    server {
        listen       443;
        server_name  mobile.dcfservice.com;
        keepalive_timeout  60;
        access_log  /data/nginx/logs/auat.dcfservice.com.log  main;
        error_log   /data/nginx/logs/auat.dcfservice.error.log;

        ssl                  on;
        ssl_certificate /usr/local/tengine/conf/fullchain.pem;
        ssl_certificate_key /usr/local/tengine/conf/privkey.pem;
        ssl_session_timeout  5m;

       # ssl_protocols  SSLv3 TLSv1;
       # ssl_ciphers  HIGH:!ADH:!EXPORT56:RC4+RSA:+MEDIUM;
       # ssl_prefer_server_ciphers   on;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-RC4-SHA:!ECDHE-RSA-RC4-SHA:ECDH-ECDSA-RC4-SHA:ECDH-RSA-RC4-SHA:ECDHE-RSA-AES256-SHA:!RC4-SHA:HIGH:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!CBC:!EDH:!kEDH:!PSK:!SRP:!kECDH;
        ssl_prefer_server_ciphers   on;


        include env.var;
        include external.var;

        location /services/ {
           if ($http_referer ~* ^(http[s]*://[a-zA-Z0-9\.\:]+)) {
                set $refer_host $1;
           }

           if ($request_method = 'OPTIONS') {
                add_header 'Access-Control-Allow-Origin' '*';
                #add_header 'Access-Control-Allow-Origin' '$refer_host';
                #add_header 'Access-Control-Allow-Origin' 'http://muat.dcfservice.com';
                add_header 'Access-Control-Max-Age' '86400';
                add_header 'Access-Control-Allow-Credentials' 'true';
                add_header 'Access-Control-Allow-Methods' 'GET,POST,OPTIONS';
                add_header 'Access-Control-Allow-Headers' 'tk, rm';
                return 204;
           }
           if ($request_method != 'OPTIONS') {
                add_header 'Access-Control-Allow-Origin' '*';
                #add_header 'Access-Control-Allow-Origin' '$refer_host';
                #add_header 'Access-Control-Allow-Origin' 'http://muat.dcfservice.com';
                add_header 'Access-Control-Max-Age' '86400';
                add_header 'Access-Control-Allow-Credentials' 'true';
                add_header 'Access-Control-Expose-Headers' 'tk, rm';
           }


           #proxy_pass http://api;
           rewrite ^/services/(.*) /v1/$1 break;
           proxy_pass http://webapp$prefix;
           proxy_set_header   Host             $host;
           proxy_set_header   X-Real-IP        $remote_addr;
           proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
           proxy_set_header   XGrayRelease   $XGrayRelease;

        }

        gzip  on;
        gzip_min_length  1000;
        gzip_buffers     4 8k;
        gzip_comp_level 7;
        gzip_types text/plain application/x-javascript text/css application/xml application/json application/octet-stream;

        error_page   404 /html/404.html;
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }

    }

    server {
        listen       80;
        listen       443;
        server_name  guat.dcfservice.com;
        keepalive_timeout  0;
        access_log  /data/nginx/logs/short-gateway.log  main;
        error_log  /data/nginx/logs/short-gateway_error.log  info;

        ssl                  on;
        ssl_certificate /usr/local/tengine/conf/fullchain.pem;
        ssl_certificate_key /usr/local/tengine/conf/privkey.pem;
        ssl_session_timeout  5m;

       # ssl_protocols  SSLv3 TLSv1;
       # ssl_ciphers  HIGH:!ADH:!EXPORT56:RC4+RSA:+MEDIUM;
       # ssl_prefer_server_ciphers   on;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-RC4-SHA:!ECDHE-RSA-RC4-SHA:ECDH-ECDSA-RC4-SHA:ECDH-RSA-RC4-SHA:ECDHE-RSA-AES256-SHA:!RC4-SHA:HIGH:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!CBC:!EDH:!kEDH:!PSK:!SRP:!kECDH;
        ssl_prefer_server_ciphers   on;


        include env.var;
        include external.var;

        location / {
           proxy_pass http://gateway$prefix;
           proxy_set_header   Host             $host;
           proxy_set_header   X-Real-IP        $remote_addr;
           proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
           proxy_set_header   XGrayRelease   $XGrayRelease;
        }
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }



    server {
        listen       80;
        listen       443 ssl http2;
        server_name  muat.dcfservice.com;
        keepalive_timeout  65;
        index index.html;
        access_log  /data/nginx/logs/muat.dcfservice.com.log  main;
        error_log   /data/nginx/logs/muat.dcfservice.error.log;

        include env.var;
        include external.var;

        location ^~ /chain {
           alias /data/static_1060;
        }

        location ^~/api/ {
           proxy_pass http://gateway$prefix;
           proxy_set_header   Host             $host;
           proxy_set_header   X-Real-IP        $remote_addr;
           proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
           proxy_set_header   XGrayRelease   $XGrayRelease;
        }

        location ^~/openapi/ {
           proxy_pass http://gateway$prefix;
           proxy_set_header   Host             $host;
           proxy_set_header   X-Real-IP        $remote_addr;
           proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
           proxy_set_header   XGrayRelease   $XGrayRelease;
        }


        location ^~/v1/ {
           proxy_pass http://webapp$prefix;
           proxy_set_header   Host             $host;
           proxy_set_header   X-Real-IP        $remote_addr;
           proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
           proxy_set_header   XGrayRelease   $XGrayRelease;
        }

        location ^~/open/ {
            proxy_pass http://open$prefix;
            proxy_set_header    Host            $host;
            proxy_set_header    X-Real-IP        $remote_addr;
            proxy_set_header    X-Forwarded-For    $proxy_add_x_forwarded_for;
            proxy_set_header   XGrayRelease   $XGrayRelease;
        }

        location ~ /(ln|md|qr|tp) {

            proxy_pass http://bi_proxy;
            proxy_set_header    Host            $host;
            proxy_set_header    X-Real-IP        $remote_addr;
            proxy_set_header    X-Forwarded-For    $proxy_add_x_forwarded_for;
 #           proxy_set_header   XGrayRelease   $XGrayRelease;
        }


        location /metersbonwe/ {
            rewrite ^(.*)$ /minisites/metersbonwe/?channel=iqx_print redirect;
        }

        location ~* ^/(?![minisites]) {
            root /data/static_1048/dist;
        #    if ( $http_user_agent ~* '(Android|webOS|iPhone|iPod|BlackBerry)') {
                #rewrite ^/(.*)$ http://muat.dcfservice.com/$1 permanent;
        #        rewrite ^/(.*)$ https://uat.dcfservice.com/m/$1 permanent;
        #    }
        }

        ssl                  on;
        ssl_certificate /usr/local/tengine/conf/fullchain.pem;
        ssl_certificate_key /usr/local/tengine/conf/privkey.pem;
        ssl_session_timeout  5m;

        #ssl_protocols  SSLv3 TLSv1;
        #ssl_ciphers  HIGH:!ADH:!EXPORT56:RC4+RSA:+MEDIUM;
        #ssl_prefer_server_ciphers   on;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-RC4-SHA:!ECDHE-RSA-RC4-SHA:ECDH-ECDSA-RC4-SHA:ECDH-RSA-RC4-SHA:ECDHE-RSA-AES256-SHA:!RC4-SHA:HIGH:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!CBC:!EDH:!kEDH:!PSK:!SRP:!kECDH;
        ssl_prefer_server_ciphers   on;


        location ^~ /services/ {
                #rewrite ^(.*)$ http://auat.dcfservice.com$1 break;
                proxy_pass http://auat.dcfservice.com;
                proxy_set_header X-Real-IP $remote_addr;
        }


        rewrite ^/view/(.*)$ https://huat.dcfservice.com/view/$1 permanent;
        rewrite ^/views/(.*)$ https://huat.dcfservice.com/views/$1 permanent;
        rewrite ^/public/(.*)$ https://huat.dcfservice.com/public/$1 permanent;
        rewrite ^/assets/(.*)$ https://huat.dcfservice.com/assets/$1 permanent;
        rewrite ^/download/(.*)$ https://huat.dcfservice.com/download/$1 permanent;


    location ^~ /video/ {
            root /data/;
        }

        location ^~ /minisites/video/ {
            alias /data/video/minisites/;
        }

        location /v1/(.*)$ {
           proxy_pass http://webapp$prefix;
           proxy_set_header   Host             $host;
           proxy_set_header   X-Real-IP        $remote_addr;
           proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
           proxy_set_header   XGrayRelease   $XGrayRelease;
        }

        location /mapi/ {
           proxy_pass http://mapi$prefix;
           proxy_set_header   Host             $host;
           proxy_set_header   X-Real-IP        $remote_addr;
           proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
           proxy_set_header   XGrayRelease   $XGrayRelease;
        }

        location ^~ /minisites {
            root /data/static_1028;
        }

        location ^~ /sales_tools {
            alias /data/static_1056;
        }

        location ^~ /jaguar {
            alias /data/static_1057;
        }

        location ^~/cashier/ {
           proxy_pass http://cashier$prefix;
           proxy_set_header   Host             $host;
           proxy_set_header   X-Real-IP        $remote_addr;
           proxy_set_header   X-Forwarded-For  $proxy_add_x_forwarded_for;
           proxy_set_header   XGrayRelease   $XGrayRelease;
        }

        location /m/ {
            alias /data/static_1013/;
            index home.html;
        }

        location / {
            root /data/static_1060;
            index index.html;
        }

        gzip  on;
        gzip_min_length  1k;
        gzip_buffers     4 16k;
        gzip_comp_level 7;
        gzip_types text/plain application/x-javascript text/css application/xml application/json application/octet-stream application/javascript image/jpeg image/gif image/png;

        error_page 404  /html/404.html;
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }
    }

